<%@page import="com.google.gson.JsonArray"%>
<%@page import="com.google.gson.JsonObject"%>
<%@page import="member.MemberDAO"%>
<%@page import="java.util.ArrayList"%>
<%@page import="java.util.List"%>
<%@page import="member.MemberDTO"%>
<%@page import="java.sql.ResultSet"%>
<%@page import="java.sql.PreparedStatement"%>
<%@page import="java.sql.DriverManager"%>
<%@page import="java.sql.Connection"%>
<%@ page language="java" contentType="text/html; charset=UTF-8"
	pageEncoding="UTF-8"%>

<%
	request.setCharacterEncoding("utf-8");  // 이건 한글로 변형 시켜주는 거(이거 없으면 한글 깨짐)
	String id = request.getParameter("id");
	String pw = request.getParameter("pw");
%>

<%
		MemberDAO dao = new MemberDAO();
		List<MemberDTO> list = dao.getMemberList();
		JsonArray jsonArray = new JsonArray();
		for(MemberDTO dto: list){
			JsonObject jsonObject = new JsonObject();
			jsonObject.addProperty("id", dto.getId());
			jsonObject.addProperty("pw", dto.getPw());	
			jsonObject.addProperty("age", dto.getAge());	
			jsonObject.addProperty("name", dto.getName());	
			jsonObject.addProperty("regdate", dto.getRegdate());
			jsonArray.add(jsonObject);
		} 
		
		boolean isId = false;
		boolean isPw = false;
		String name = "";
		
		MemberDTO dto = new MemberDTO();
		dto.setId(id);
		dto = dao.getMember(dto);
		String rs = "0"; 
		if(dto != null) {
			isId = true;
			name = dto.getName();
			pw = dto.getPw();
			if(dto.getPw().equals(pw)) {
				isPw = true;
				rs = "1";
				%>jsonObject.addProperty("rs", rs);<%
			}
		}	
		
			
		// response.sendRedirect("idcheck.jsp?rs=" + rs);
		

		out.print(jsonArray.toString());
%>
<%
	if(isId && isPw) {
		session.setAttribute("id", id);
		session.setAttribute("pw", pw);
		session.setAttribute("name", name);
		response.sendRedirect("index.jsp");
	} 
%>



